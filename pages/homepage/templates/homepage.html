{% extends 'base.html' %}

{% block title %}Home - SophieBoca{% endblock %}

{% block content %}
<section id="section-1" class="section">
    <div class="dog-div">
        <img src="{{ url_for('homepage.static', filename='media/dog.png') }}" alt="Dog" class="dog-image-main">
    </div>
    <header class="hero-section">
        <div class="center-image">
            <img src="{{ url_for('homepage.static', filename='media/center-image.png') }}" alt="Find Love, Adopt a Friend">
        </div>
        <div class="first-text">
            <button class="primary-btn" id="search-by-photo-btn">
                <i class="fa fa-camera"></i> Search by photo
            </button>
            <p class="description">Looking for a specific breed? Snap a photo and let us help you find a match!</p>
        </div>
        <div class="second-text">
            <p class="subtitle">What we do?</p>
            <p class="description2">
                It is a long-established fact that a reader will be distracted by the readable content of a page when looking at its layout.
            </p>
            <a href="{{ url_for('pets.index') }}" class="primary-btn">View Pets</a>
        </div>
    </header>
</section>

<!-- Modal for image upload -->
<div id="uploadModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Upload an Image</h2>
        <label class="custom-file-upload">
            <input type="file" id="imageUpload" accept="image/*">
            <i class="fa fa-upload"></i>
        </label>
        <p id="fileName"></p>
        <button id="predict-btn" class="primary-btn">Search</button>
        <p id="breedResult"></p>
    </div>
</div>

<section id="section-2" class="section">
    <h2>Join Our Community</h2>
    <p>Be a voice for pets in need. Participate in events, connect with other pet lovers, and help us create a community where every pet finds a home.</p>
    <div class="highlights">
        <div class="highlight-item">
            <i class="fa fa-calendar-alt fa-2x"></i>
            <h3>Events</h3>
            <p>Join pet-friendly activities in your area.</p>
        </div>
        <div class="highlight-item">
            <i class="fa fa-heart fa-2x"></i>
            <h3>Community Stories</h3>
            <p>Share and read inspiring adoption stories.</p>
        </div>
        <div class="highlight-item">
            <i class="fa fa-info-circle fa-2x"></i>
            <h3>Resources</h3>
            <p>Get tips for first-time pet parents.</p>
        </div>
        <button class="primary-btn" id="join-community-btn">
            <i class="fa fa-user-plus"></i> Join Our Community
        </button>
    </div>
</section>

<section id="section-3" class="section">
    <h2>Adopt a Friend</h2>
    <p>Browse through thousands of pets waiting for a forever home.</p>
</section>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-align: center;
        max-width: 400px;
        width: 90%;
    }

    .close-btn {
        float: right;
        font-size: 24px;
        cursor: pointer;
    }

    .custom-file-upload {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        width: 60px;
        height: 60px;
        border: 2px solid lightgray;
        border-radius: 50%;
        cursor: pointer;
        color: lightgray;
        font-size: 24px;
        transition: all 0.3s ease;
        background-size: cover;
        background-position: center;
    }

    .custom-file-upload.uploaded {
        width: 100px;
        height: 100px;
    }

    .custom-file-upload:hover {
        background-color: rgba(211, 211, 211, 0.2);
    }

    .custom-file-upload input[type="file"] {
        display: none;
    }

    #fileName {
        margin-top: 10px;
        font-style: italic;
    }

    #predict-btn {
        margin-top: 20px;
    }
</style>

<script>
    document.getElementById('search-by-photo-btn').onclick = function() {
        document.getElementById('uploadModal').style.display = 'flex';
    };

    document.querySelector('.close-btn').onclick = function() {
        document.getElementById('uploadModal').style.display = 'none';
    };

    window.onclick = function(event) {
        const modal = document.getElementById('uploadModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    document.getElementById('imageUpload').onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const uploadLabel = document.querySelector('.custom-file-upload');
                uploadLabel.style.backgroundImage = `url('${e.target.result}')`;
                uploadLabel.classList.add('uploaded');
                uploadLabel.querySelector('i').style.display = 'none';
            };
            reader.readAsDataURL(file);

            document.getElementById('fileName').innerText = file.name;
        }
    };

    document.getElementById('predict-btn').onclick = function() {
        const fileInput = document.getElementById('imageUpload');
        const file = fileInput.files[0];

        if (file) {
            const formData = new FormData();
            formData.append('file', file);

            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.breed) {
                    document.getElementById('breedResult').innerText = `Predicted Breed: ${data.breed}`;
                } else {
                    document.getElementById('breedResult').innerText = 'Could not identify the breed.';
                }
            })
            .catch(error => console.error('Error:', error));
        } else {
            alert('Please upload an image first.');
        }
    };
</script>

{% endblock %}